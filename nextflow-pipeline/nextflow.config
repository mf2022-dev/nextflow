/*
========================================================================================
    BioNXA UPEC Genomics Pipeline - Configuration
========================================================================================
*/

// Pipeline parameters
params {
    // Input/Output paths
    genomes = "../data/dropbox_assemblies/*.fa"
    outdir = "results"
    
    // Tool-specific parameters
    prokka_kingdom = "Bacteria"
    prokka_genus = "Escherichia"
    mlst_scheme = "ecoli"
    abricate_minid = 80
    abricate_mincov = 60
    
    // Resource limits
    max_cpus = 16
    max_memory = 64.GB
    max_time = 24.h
    
    // Pipeline options
    skip_prokka = false
    skip_mlst = false
    skip_amr = false
    skip_virulence = false
}

// Process resource labels
process {
    // Default resources
    cpus = 2
    memory = 4.GB
    time = 2.h
    errorStrategy = 'retry'
    maxRetries = 3
    
    // Specific process resources
    withLabel: process_low {
        cpus = 2
        memory = 4.GB
        time = 1.h
    }
    
    withLabel: process_medium {
        cpus = 4
        memory = 8.GB
        time = 4.h
    }
    
    withLabel: process_high {
        cpus = 8
        memory = 16.GB
        time = 8.h
    }
    
    withLabel: process_long {
        time = 24.h
    }
    
    // Process-specific containers
    withName: PROKKA {
        container = 'staphb/prokka:1.14.6'
    }
    
    withName: MLST {
        container = 'staphb/mlst:2.23.0'
    }
    
    withName: 'ABRICATE.*' {
        container = 'staphb/abricate:1.0.1'
    }
}

// Execution profiles
profiles {
    // Standard local execution
    standard {
        process.executor = 'local'
        process.cpus = 2
        process.memory = 4.GB
    }
    
    // Docker execution
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
    }
    
    // Singularity execution
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        singularity.cacheDir = "$HOME/.singularity/cache"
    }
    
    // HPC cluster (SLURM)
    cluster {
        process.executor = 'slurm'
        process.queue = 'batch'
        process.clusterOptions = '--qos=normal'
    }
    
    // AWS Batch
    aws {
        process.executor = 'awsbatch'
        process.queue = 'genomics-queue'
        aws.region = 'us-east-1'
        aws.batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
    }
    
    // Google Cloud
    gcp {
        process.executor = 'google-lifesciences'
        google.region = 'us-central1'
        google.project = 'my-project-id'
    }
    
    // Testing with small dataset
    test {
        params.genomes = "../data/fasta_files_real/*.fasta"
        params.max_cpus = 4
        params.max_memory = 16.GB
    }
}

// Execution report
report {
    enabled = true
    file = "${params.outdir}/execution_report.html"
}

timeline {
    enabled = true
    file = "${params.outdir}/execution_timeline.html"
}

trace {
    enabled = true
    file = "${params.outdir}/execution_trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_dag.html"
}

// Manifest
manifest {
    name = 'BioNXA-UPEC-Pipeline'
    author = 'BioNXA Team'
    homePage = 'https://github.com/mf2022-dev/BioNXA'
    description = 'Nextflow pipeline for UPEC genomic characterization'
    mainScript = 'main.nf'
    nextflowVersion = '>=21.10.0'
    version = '1.0.0'
}
